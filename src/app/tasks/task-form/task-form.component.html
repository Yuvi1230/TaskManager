<section class="task-form-wrapper container py-4 py-md-5" [class.edit-mode-wrap]="isEditMode">
  <div class="task-form-card mx-auto" [class.edit-card]="isEditMode">
    @if (isEditMode) {
      <header class="edit-header">
        <h1 class="mb-0">Edit Task</h1>
        <div class="edit-header-meta">
          <span class="task-id">Task ID: #{{ displayTaskId }}</span>
          <span class="header-dot" aria-hidden="true"></span>
        </div>
      </header>
    }

    <div class="task-form-body p-4 p-md-4">
      @if (!isEditMode) {
        <h1 class="mb-1">Create Task</h1>
        <p class="text-muted mb-4">Add a new task to your dashboard.</p>
      }

      @if (errorMessage) {
        <div class="alert alert-danger">{{ errorMessage }}</div>
      }

      <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" novalidate>
        <div class="mb-3">
          <label for="title" class="form-label">{{ isEditMode ? 'TASK TITLE *' : 'Task Title' }}</label>
          <input id="title" type="text" class="form-control" formControlName="title" />
          @if (hasError('title')) {
            <small class="text-danger">Task title is required.</small>
          }
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">{{ isEditMode ? 'DESCRIPTION' : 'Description' }}</label>
          <textarea
            id="description"
            class="form-control"
            rows="3"
            formControlName="description"
            placeholder="Optional details about the task"
          ></textarea>
        </div>

        <div class="row g-3 align-items-end">
          <div class="col-md-6">
            <label for="dueDate" class="form-label">{{ isEditMode ? 'DUE DATE *' : 'Due Date' }}</label>
            <input id="dueDate" type="date" class="form-control" formControlName="dueDate" />
            @if (hasError('dueDate')) {
              <small class="text-danger">Due date is required.</small>
            }
          </div>

          <div class="col-md-6">
            <label for="status" class="form-label">{{ isEditMode ? 'STATUS' : 'Status' }}</label>
            <div class="status-field">
              <select id="status" class="form-select" formControlName="status">
                @for (status of statusOptions; track status.value) {
                  <option [value]="status.value">{{ status.label }}</option>
                }
              </select>
              @if (isEditMode) {
                <span [class]="selectedStatusBadgeClass">{{ selectedStatusLabel }}</span>
              }
            </div>
          </div>
        </div>

        @if (isEditMode) {
          <div class="meta-box mt-3">
            <p class="meta-title mb-1">Last modified:</p>
            <p class="meta-text mb-0">Current status: {{ selectedStatusLabel }} | Due date: {{ taskForm.value.dueDate || '-' }}</p>
          </div>

          <div class="danger-zone mt-3">
            <span>Danger zone: This action is permanent and cannot be undone.</span>
            <button type="button" class="btn btn-danger btn-sm ms-auto" (click)="onDelete()">Delete Task</button>
          </div>
        }

        <div class="d-flex flex-wrap gap-2 mt-4 form-actions">
          <button type="button" class="btn btn-outline-secondary px-4 action-cancel" (click)="onCancel()">Cancel</button>
          <button type="submit" class="btn btn-primary px-4 action-save">
            {{ isEditMode ? 'Save Changes' : 'Create Task' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
